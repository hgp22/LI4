@using Microsoft.AspNetCore.Components.Forms
@page "/criarleilao"
@inject NavigationManager NavigationManager
@using Controllers
@using Models
@inject ILeilaoController leilaoController
@inject IVeiculoController veiculoController
@attribute [Authorize(Roles = "Administrator")]

<style>
    .form-box {
        background-color: #12232e;
    }
</style>

<PageTitle>Detalhes do Veículo</PageTitle>

<div class="text-white">
    <div class="font-bold dark:bg-gray-800 p-4 px-16 mb-8">
        <div class="text-4xl gap-4">New Auction</div>
    </div>

    <EditForm Model="@leilao" OnValidSubmit="Criar">

        <div class="items-center justify-center p-8">
            <div class="grid grid-cols-2 min-h-screen space-x-8 inline-block mb-8">

                <div class="dark:bg-gray-800 mb-8 p-4 px-4">

                    <div class="text-xl underline mb-4">Car Details</div>

                    <div class="form-group mb-4">
                        <label for="titulo" class="block text-sm font-semibold text-gray-600">ID</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="leilao.Id" />
                        <ValidationMessage For="@(()=>leilao.Id)" />
                    </div>

                    <div class="form-group mb-4">
                        <label for="titulo" class="block text-sm font-semibold text-gray-600">Title</label>
                        <InputText class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="leilao.Titulo" />
                        <ValidationMessage For="@(()=>leilao.Titulo)" />
                    </div>

                    <div class="form-group mb-4">
                        <label for="ano" class="block text-sm font-semibold text-gray-600">Year</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.Ano" />
                        <ValidationMessage For="@(()=>veiculo.Ano)" />
                    </div>

                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Brand</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.IdMarca" />
                        <ValidationMessage For="@(()=>veiculo.IdMarca)" />
                    </div>

                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Model</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.IdModelo" />
                        <ValidationMessage For="@(()=>veiculo.IdModelo)" />
                    </div>

                    <div class="form-group mb-4">
                        <label for="descricao" class="block text-sm font-semibold text-gray-600">Description</label>
                        <textarea class="text-white w-full px-4 py-2 border rounded-md
                        focus:outline-none focus:border-blue-500
                        form-box" placeholder="Leave a message here" required>
                        <InputText class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="leilao.Descricao" />
                        <ValidationMessage For="@(()=>leilao.Descricao)" />
                        </textarea>
                    </div>

                </div>

                <div class="dark:bg-gray-800 mb-8 p-4 px-4">

                    <div class="text-xl underline mb-4">Other Details</div>

                    <!--Combustivel-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Fuel</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.TipoMotor" />
                        <ValidationMessage For="@(()=>veiculo.TipoMotor)" />
                    </div>

                    <!--Cor-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Color</label>
                        <InputText class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.CorExterior" />
                        <ValidationMessage For="@(()=>veiculo.CorExterior)" />
                    </div>
                    <!--Portas-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Doors</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.NumPortas" />
                        <ValidationMessage For="@(()=>veiculo.NumPortas)" />
                    </div>
                    <!--Lugares-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Seats</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.Lugares" />
                        <ValidationMessage For="@(()=>veiculo.Lugares)" />
                    </div>

                    <!--Cilindrada-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Engine Capacity</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.Cilindrada" />
                        <ValidationMessage For="@(()=>veiculo.Cilindrada)" />
                    </div>

                    <!--Potencia-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Power</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.Potencia" />
                        <ValidationMessage For="@(()=>veiculo.Potencia)" />
                    </div>

                    <!--Mileage-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Mileage</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="veiculo.Quilometragem" />
                        <ValidationMessage For="@(()=>veiculo.Quilometragem)" />
                    </div>
                </div>

                <div class="dark:bg-gray-800 mb-8 p-4 px-4">

                    <div class="text-xl underline mb-4">Auction Details</div>

                    <!--Start Price-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Start Price</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                                        focus:border-blue-500 form-box" @bind-Value="leilao.ValorInicial" />
                        <ValidationMessage For="@(()=>leilao.ValorInicial)" />
                    </div>

                    <!--Minimum Bid-->
                    <div class="form-group mb-4">
                        <label for="modelo" class="block text-sm font-semibold text-gray-600">Minimum Bid</label>
                        <InputNumber class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="leilao.AumentoMinimo" />
                        <ValidationMessage For="@(()=>leilao.AumentoMinimo)" />
                    </div>
                    <!--End Date-->
                    <div class="form-group mb-4">
                        <label for="endDate" class="block text-sm font-medium text-gray-600">End Date</label>
                        <InputDate id="endDate" class="text-white w-full px-4 py-2 border rounded-md focus:outline-none
                        focus:border-blue-500 form-box" @bind-Value="leilao.DataFinal"></InputDate>
                    </div>
                </div>


                <div class="dark:bg-gray-800 mb-8 p-4 px-4">

                    <div class="text-xl underline mb-4">Images & Videos</div>
                    <div>
                        <input type="file" accept="image/*,video/*" multiple @onchange="HandleFiles">
                    </div>
                </div>
            </div>

            <div class="flex item-center justify-center">
                <button type="submit" class="mb-5 bg-blue-500 text-blue
                            px-8 p-2 rounded-md hover:bg-blue-600 focus:outline-none
                            focus:border-blue-700 focus:ring focus:ring-blue-200
                            login-button mb-8 text-3xl font-bold">
                    Start Auction
                </button>
            </div>

        </div>

    </EditForm>

</div>


@code {
    [Parameter]
    public int LeilaoID { get; set; }
    private Leilao leilao = new();
    private Veiculo veiculo = new();
    private string message = String.Empty;

    private void Criar()
    {

        if (veiculoController.Create(veiculo))
        {
            Console.WriteLine("Returned: {true}");
            leilao.IdVeiculo = veiculo.Id;
            if (leilaoController.Create(leilao))
            {
                message = "Adicionado com Sucesso!";
                veiculo = new();
                leilao = new();
            }
        }
        else
        {
            message = "Leilão não foi adicionado!";
        }
    }

    private async Task HandleFiles(ChangeEventArgs e)
    {
        var files = e.Value as IEnumerable<IBrowserFile>;
        foreach (var file in files)
        {
            // Process each file here
            // For example, you can read the file content and upload it to a server
        }
    }
}
